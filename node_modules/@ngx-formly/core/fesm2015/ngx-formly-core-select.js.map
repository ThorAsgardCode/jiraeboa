{"version":3,"file":"ngx-formly-core-select.js.map","sources":["ng://@ngx-formly/core/select/select-options.pipe.ts","ng://@ngx-formly/core/select/select.module.ts"],"sourcesContent":["import { OnDestroy, Pipe, PipeTransform } from '@angular/core';\nimport { BehaviorSubject, Observable, Subscription } from 'rxjs';\nimport { filter, map, tap } from 'rxjs/operators';\nimport { FormlyFieldConfig } from '@ngx-formly/core';\n\n@Pipe({ name: 'formlySelectOptions' })\nexport class FormlySelectOptionsPipe implements PipeTransform, OnDestroy {\n  private _subscription: Subscription;\n  private _options: BehaviorSubject<any[]>;\n\n  transform(options, field?: FormlyFieldConfig) {\n    if (!(options instanceof Observable)) {\n      options = this.observableOf(options, field);\n    } else {\n      this.dispose();\n    }\n\n    return (options as Observable<any>).pipe(\n      map(value => this.toOptions(value, field || {})),\n    );\n  }\n\n  ngOnDestroy(): void {\n    this.dispose();\n  }\n\n  private toOptions(options, field: FormlyFieldConfig) {\n    const gOptions: any[] = [],\n      groups: { [key: string]: any[] } = {},\n      to = field.templateOptions || {};\n\n    to._flatOptions = true;\n    options.map((option: any) => {\n      if (!this.getGroupProp(option, to)) {\n        gOptions.push(this.toOption(option, to));\n      } else {\n        to._flatOptions = false;\n        if (!groups[this.getGroupProp(option, to)]) {\n          groups[this.getGroupProp(option, to)] = [];\n          gOptions.push({\n            label: this.getGroupProp(option, to),\n            group: groups[this.getGroupProp(option, to)],\n          });\n        }\n        groups[this.getGroupProp(option, to)].push(this.toOption(option, to));\n      }\n    });\n\n    return gOptions;\n  }\n\n  private toOption(item, to) {\n    return {\n      label: this.getLabelProp(item, to),\n      value: this.getValueProp(item, to),\n      disabled: this.getDisabledProp(item, to) || false,\n    };\n  }\n\n  private getLabelProp(item, to): string {\n    if (typeof to.labelProp === 'function') {\n      return to.labelProp(item);\n    }\n\n    if (this.shouldUseLegacyOption(item, to)) {\n      console.warn(`NgxFormly: legacy select option '{key, value}' is deprecated since v5.5, use '{value, label}' instead.`);\n      return item.value;\n    }\n\n    return item[to.labelProp || 'label'];\n  }\n\n  private getValueProp(item, to): string {\n    if (typeof to.valueProp === 'function') {\n      return to.valueProp(item);\n    }\n\n    if (this.shouldUseLegacyOption(item, to)) {\n      return item.key;\n    }\n\n    return item[to.valueProp || 'value'];\n  }\n\n  private getDisabledProp(item, to): string {\n    if (typeof to.disabledProp === 'function') {\n      return to.disabledProp(item);\n    }\n    return item[to.disabledProp || 'disabled'];\n  }\n\n  private getGroupProp(item, to): string {\n    if (typeof to.groupProp === 'function') {\n      return to.groupProp(item);\n    }\n\n    return item[to.groupProp || 'group'];\n  }\n\n  private shouldUseLegacyOption(item, to) {\n    return !to.valueProp\n      && !to.labelProp\n      && item != null\n      && typeof item === 'object'\n      && 'key' in item\n      && 'value' in item;\n  }\n\n  private dispose() {\n    if (this._options) {\n      this._options.complete();\n      this._options = null;\n    }\n\n    if (this._subscription) {\n      this._subscription.unsubscribe();\n      this._subscription = null;\n    }\n  }\n\n  private observableOf(options, f?: FormlyFieldConfig) {\n    this.dispose();\n    if (f && f.options && f.options.fieldChanges) {\n      this._subscription = f.options.fieldChanges.pipe(\n        filter(({ property, type, field }) => {\n          return type === 'expressionChanges'\n            && property.indexOf('templateOptions.options') === 0\n            && field === f\n            && Array.isArray(field.templateOptions.options)\n            && !!this._options;\n        }),\n        tap(() => this._options.next(f.templateOptions.options as any)),\n      ).subscribe();\n    }\n\n    this._options = new BehaviorSubject(options);\n    return this._options.asObservable();\n  }\n}\n","import { NgModule } from '@angular/core';\nimport { FormlySelectOptionsPipe } from './select-options.pipe';\n\n@NgModule({\n  declarations: [FormlySelectOptionsPipe],\n  exports: [FormlySelectOptionsPipe],\n})\nexport class FormlySelectModule { }\n"],"names":[],"mappings":"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"}
